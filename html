<!DOCTYPE html>
<html>
<head>
    <title data-i18n="character_sheet">Character Sheet</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="charsheet">
        <header>
           <img src="https://i.ibb.co/k38ns0w/creswordalone.png" style="width:252px;height:92px;" alt="CRE Logo" class="logo">
            <h1 data-i18n="character_sheet">Character Sheet</h1>
        </header>
        <div class="main-content">
            <section class="char-info">
                <h2 data-i18n="character_information">Character Information</h2>
                <div class="field-group">
                    <div class="field">
                        <label for="char_name" data-i18n="character_name">Character Name</label>
                        <input type="text" name="attr_char_name" value="">
                    </div>
                    <div class="field">
                        <label for="race" data-i18n="race">Race</label>
                        <input type="text" name="attr_race" value="">
                    </div>
                    <div class="field">
                        <label for="class" data-i18n="class">Class</label>
                        <input type="text" name="attr_class" value="">
                    </div>
                    <div class="field">
                        <label for="player_name" data-i18n="player_name">Player Name</label>
                        <input type="text" name="attr_player_name" value="">
                    </div>
                </div>
            </section>
            <section class="attributes">
                <h2 data-i18n="attributes">Attributes</h2>
                <div class="field-group">
                    <div class="field">
                        <label for="armor_type" data-i18n="armor_type">Armor Type</label>
                        <select name="attr_armor_type">
                            <option value="unarmored" data-i18n="unarmored">Unarmored</option>
                            <option value="light" data-i18n="light">Light</option>
                            <option value="medium" data-i18n="medium">Medium</option>
                            <option value="heavy" data-i18n="heavy">Heavy</option>
                            <option value="very_heavy" data-i18n="very_heavy">Very Heavy</option>
                            <option value="custom" data-i18n="custom">Custom</option>
                        </select>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field">
                        <label for="damage_reduction" data-i18n="damage_reduction">Damage Reduction (DR)</label>
                        <input type="number" name="attr_damage_reduction" value="">
                    </div>
                    <div class="field">
                        <label for="damage_modifier" data-i18n="damage_modifier">Damage Modifier</label>
                        <input type="number" name="attr_damage_modifier" value="">
                    </div>
                    <div class="field">
                        <label for="hp" data-i18n="hp">HP</label>
                        <input type="number" name="attr_hp" value="">
                    </div>
                    <div class="field">
                        <label for="armor_traits" data-i18n="armor_traits">Armor Trait</label>
                        <input type="text" name="attr_armor_traits" value="">
                    </div>
                                        <div class="field">
                        <label for="armor_traits" data-i18n="weapon_traits">Weapon Trait</label>
                        <input type="text" name="attr_weapon_traits" value="">
                    </div>
                </div>
            </section>
            <section class="skills">
                <h2 data-i18n="skills">Skills</h2>
                <div class="field">
                    <label for="skill_points" data-i18n="skill_points">Skill Points: <span id="skill_points_display">4</span></label>
                    <input type="number" name="attr_skill_points" value="4" readonly hidden>
                </div>
                <div class="skills-columns">
                    <div class="skills-column">
                        <div class="field">
                            <input type="number" name="attr_surge" value="0" class="skill-input">
                            <label for="surge" data-i18n="surge">Surge</label>
                        </div>
                        <div class="field">
                            <input type="number" name="attr_block" value="0" class="skill-input">
                            <label for="block" data-i18n="block">Block</label>
                        </div>
                        <div class="field">
                            <input type="number" name="attr_heal" value="1" class="skill-input">
                            <label for="heal" data-i18n="heal">Heal</label>
                        </div>
                    </div>
                    <div class="skills-column">
                        <div class="field">
                            <input type="number" name="attr_cleave" value="0" class="skill-input">
                            <label for="cleave" data-i18n="cleave">Cleave</label>
                        </div>
                        <div class="field">
                            <input type="number" name="attr_taunt" value="0" class="skill-input">
                            <label for="taunt" data-i18n="taunt">Taunt</label>
                        </div>
                        <div class="field">
                            <input type="number" name="attr_focus" value="0" class="skill-input">
                            <label for="focus" data-i18n="focus">Focus</label>
                        </div>
                    </div>
                </div>
            </section>
            <section class="dice-rolls">
                <h2 data-i18n="dice_rolls">Dice Rolls</h2>
                <div class="dice-buttons">
                    <button type="roll" value="/roll 1d20" name="roll_D20" class="dice-button" data-dice="d20">D20</button>
                    <button type="roll" value="/roll 1d10" name="roll_D10" class="dice-button" data-dice="d10">D10</button>
                    <button type="roll" value="/roll 1d6" name="roll_D6" class="dice-button" data-dice="d6">D6</button>
                    <button type="roll" value="/roll 1d4" name="roll_D4" class="dice-button" data-dice="d4">D4</button>
                </div>
            </section>
            <section class="advanced-skills">
                <h2 data-i18n="advanced_skills">Advanced Skills</h2>
                <div id="advanced-skills-list">
                    <div class="field">
                        <label for="adv_skill_1" data-i18n="advanced_skill_1">Advanced Skill 1</label>
                        <input type="text" name="attr_adv_skill_1" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="advanced_skill_2">Advanced Skill 2</label>
                        <input type="text" name="attr_adv_skill_2" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="advanced_skill_3">Advanced Skill 3</label>
                        <input type="text" name="attr_adv_skill_3" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="advanced_skill_4">Advanced Skill 4</label>
                        <input type="text" name="attr_adv_skill_4" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="advanced_skill_5">Advanced Skill 5</label>
                        <input type="text" name="attr_adv_skill_5" value="">
                    </div>
                </div>
            </section>
            <section class="elite-skills">
                <h2 data-i18n="elite_skills">Elite Skills</h2>
                <div id="elite-skills-list">
                    <div class="field">
                        <label for="elite_skill_1" data-i18n="elite_skill_1">Elite Skill 1</label>
                        <input type="text" name="attr_elite_skill_1" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="elite_skill_2">Elite Skill 2</label>
                        <input type="text" name="attr_elite_skill_2" value="">
                    </div>
                    <div class="field">
                        <label data-i18n="elite_skill_3">Elite Skill 3</label>
                        <input type="text" name="attr_elite_skill_3" value="">
                    </div>
                </div>
            </section>
        </div>

        <script type="text/worker">
            on("change:armor_type sheet:opened", function() {
                getAttrs(["armor_type"], function(values) {
                    let armorType = values.armor_type;
                    let dr, dmgMod, hp;

                    switch (armorType) {
                        case 'unarmored':
                            dr = 2;
                            dmgMod = 4;
                            hp = 8;
                            break;
                        case 'light':
                            dr = 3;
                            dmgMod = 2;
                            hp = 10;
                            break;
                        case 'medium':
                            dr = 4;
                            dmgMod = 1;
                            hp = 12;
                            break;
                        case 'heavy':
                            dr = 5;
                            dmgMod = 0;
                            hp = 14;
                            break;
                        case 'very_heavy':
                            dr = 6;
                            dmgMod = -1;
                            hp = 16;
                            break;
                        case 'custom':
                            dr = 0;
                            dmgMod = 0;
                            hp = 0;
                            break;
                        default:
                            dr = 0;
                            dmgMod = 0;
                            hp = 0;
                            break;
                    }

                    setAttrs({
                        damage_reduction: dr,
                        damage_modifier: dmgMod,
                        hp: hp
                    });
                });
            });
        </script>

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
                document.querySelector('select[name="attr_armor_type"]').addEventListener('change', function() {
                    let customArmorFields = document.querySelectorAll('.custom-armor');
                    if (this.value === 'custom') {
                        customArmorFields.forEach(field => field.style.display = 'block');
                    } else {
                        customArmorFields.forEach(field => field.style.display = 'none');
                    }
                });

                // Update skill points dynamically
                const skillInputs = document.querySelectorAll('.skill-input');
                const skillPointsDisplay = document.getElementById('skill_points_display');
                let skillPoints = 4;

                function updateSkillPoints() {
                    let totalPointsUsed = 0;
                    skillInputs.forEach(input => {
                        totalPointsUsed += parseInt(input.value) || 0;
                    });
                    skillPoints = 4 - totalPointsUsed;
                    skillPointsDisplay.textContent = skillPoints;
                }

                skillInputs.forEach(input => {
                    input.addEventListener('input', function() {
                        updateSkillPoints();
                    });
                });

                // Trigger initial check
                document.querySelector('select[name="attr_armor_type"]').dispatchEvent(new Event('change'));
                updateSkillPoints(); // Initialize skill points on page load
            });
        </script>
    </div>
</body>
</html>
